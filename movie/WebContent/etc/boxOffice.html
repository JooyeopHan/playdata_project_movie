<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>영화 검색</title>
</head>
<body>
	<h1>영화진흥위원회 일별 박스오피스 API 요청</h1>
	<button onclick=callAPI()>일일 박스 오피스 요청</button>
<!-- 	<button onclick = saveMovie()>요청 명단 저장</button> -->
	
	<h1>오늘의 박스 오피스 랭킹</h1>
	<h3></h3>
	<h4 id = "result"></h4>
	
<script src="https://code.jquery.com/jquery-3.6.3.js" 
integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM=" 
crossorigin="anonymous"></script>	

<script>
const today = Date()
console.log(today)


function callAPI(){$.ajax({
	  method: "GET",
	  url: "http://www.kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json",
	  data :{key : "8ef8d0855390695f37c6d9af6fd08725", targetDt : "20230103"},
	  complete:function(xhr,status){
	    	console.log("complete")
	    	var dom1 = document.getElementsByTagName("name")  
	
	    	var boxOfficeDaily = []

	    	for (var j =0; j<dom1.length; j++){
	    		boxOfficeDaily.push(dom1[j].textContent)
	    		console.log(dom1[j].textContent)
	    	}
	    	if(boxOfficeDaily.length != 0){
	    		console.log(boxOfficeDaily)
	    	}
	    	else {
	    		window.alert("해당하는 영화가 존재하지 않습니다.")
	    	}
	    	// NaverAPI를 통해 썸네일을 받아와야 됌
	    	$.ajax({
	    		url : "naverAPI",
	    		method:"POST",
	    		data : {
	    			/*박스오피스 1~10위 전송 (리스트 보내는 방법을 모름, 보내도 안받아짐 null값) */
	    			boxOfficeDaily0 : boxOfficeDaily[0],
	    			boxOfficeDaily1 : boxOfficeDaily[1],
	    			boxOfficeDaily2 : boxOfficeDaily[2],
	    			boxOfficeDaily3 : boxOfficeDaily[3],
	    			boxOfficeDaily4 : boxOfficeDaily[4],
	    			boxOfficeDaily5 : boxOfficeDaily[5],
	    			boxOfficeDaily6 : boxOfficeDaily[6],
	    			boxOfficeDaily7 : boxOfficeDaily[7],
	    			boxOfficeDaily8 : boxOfficeDaily[8],
	    			boxOfficeDaily9 : boxOfficeDaily[9],
	    			
	    		},
	    		success: function (resultText) {
	                 $('#result').html(resultText);
	    		}
	    		/* complete : function(xhr,status){
	    			location.href = "/movie/naverAPI" 
	    		} */
	    		
	    	
	    	})
	    	
	    	
	    }
	  
	})
	  .done(function( msg ) {
	    for(var i=0; i < msg.boxOfficeResult.dailyBoxOfficeList.length ; i++){
	    /* $(" h3 ").append("<name id = "+i+">"+"Rank"+(i+1)+"위 :  "+msg.boxOfficeResult.dailyBoxOfficeList[i].movieNm+"</name><br>") */
	    	$(" h3 ").append("<name>"+msg.boxOfficeResult.dailyBoxOfficeList[i].movieNm+"</name><br>")
	    	
	    } 
	    
	   
	    
	  });}


</script>




</body>
</html>